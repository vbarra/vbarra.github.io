<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Homepage - Vincent BARRA - Computer Science and Volcanology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Homepage - Vincent BARRA - Computer Science and Volcanology">
<meta property="og:description" content="">
<meta property="og:image" content="../img/volcano.png">
<meta property="og:site-name" content="Homepage - Vincent BARRA">
<meta name="twitter:title" content="Homepage - Vincent BARRA - Computer Science and Volcanology">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="../img/volcano.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Homepage - Vincent BARRA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target=""><i class="bi bi-question-circle" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target=""><i class="bi bi-calculator" role="img">
</i> 
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target=""><i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../talks.html" rel="" target=""><i class="bi bi-easel" role="img">
</i> 
 <span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../students.html" rel="" target=""><i class="bi bi-mortarboard" role="img">
</i> 
 <span class="menu-text">phD Students</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html" rel="" target=""><i class="bi bi-journal-bookmark" role="img">
</i> 
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../admin.html" rel="" target=""><i class="bi bi-bank" role="img">
</i> 
 <span class="menu-text">Admin</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contact.html" rel="" target=""><i class="bi bi-person-circle" role="img">
</i> 
 <span class="menu-text">Contact</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
  <ul>
  <li><a href="#deep-learning-analysis-of-multiprobe-sensor-networks-to-assess-risk-scenarios-at-volcanic-hydrothermal-ecosystems" id="toc-deep-learning-analysis-of-multiprobe-sensor-networks-to-assess-risk-scenarios-at-volcanic-hydrothermal-ecosystems" class="nav-link active" data-scroll-target="#deep-learning-analysis-of-multiprobe-sensor-networks-to-assess-risk-scenarios-at-volcanic-hydrothermal-ecosystems">Deep Learning analysis of multiprobe sensor networks to assess risk scenario’s at volcanic hydrothermal ecosystems</a>
  <ul class="collapse">
  <li><a href="#related-publications" id="toc-related-publications" class="nav-link" data-scroll-target="#related-publications">Related publications</a></li>
  </ul></li>
  <li><a href="#characterization-of-volcanic-emissions-through-thermal-vision" id="toc-characterization-of-volcanic-emissions-through-thermal-vision" class="nav-link" data-scroll-target="#characterization-of-volcanic-emissions-through-thermal-vision">Characterization of volcanic emissions through thermal vision</a>
  <ul class="collapse">
  <li><a href="#related-publications-1" id="toc-related-publications-1" class="nav-link" data-scroll-target="#related-publications-1">Related publications</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<div class="quarto-about-solana column-page-left">
  <div class="about-entity">
    <div class="entity-contents">
      <header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Computer Science and Volcanology</h1>
</div>
<div class="quarto-title-meta">
  </div>
</header> 
      <div class="about-contents"><main class="content column-page-left" id="quarto-document-content">

<section id="deep-learning-analysis-of-multiprobe-sensor-networks-to-assess-risk-scenarios-at-volcanic-hydrothermal-ecosystems" class="level2">
<h2 data-anchor-id="deep-learning-analysis-of-multiprobe-sensor-networks-to-assess-risk-scenarios-at-volcanic-hydrothermal-ecosystems">Deep Learning analysis of multiprobe sensor networks to assess risk scenario’s at volcanic hydrothermal ecosystems</h2>
<hr>
<p>Volcanic hydrothermal systems are poorly-considered, long-fuse environmental time bombs. They involve complex process-response systems with spatially and temporally varying flows of heat and mass from deep volcanic sources to the Earth’s surface. Across such zones, high concentrations of volcanic gas and extreme heat fluxes act as environmental polluters, killing-off flora and fauna across wide zones. Such systems are extremely common and involve some of the highest, sustained, heat fluxes on the planet. The objective of this research project is to build Deep-Learning data-driven models that will allow to send alerts concerning the timing, location and hazard level of environmental crises at hydrothermal systems. Potential outcomes can then be assessed by examining past crises and their ecosystem impacts. The scientific context of this work is the ANR funded project DIRE (Data-Integration, Risk and the Environment) leaded by three CNRS labs of Clermont-Ferrand (LMV , LIMOS , LPC ), in collaboration with national (IRD) and international (INGV Italy, Univ. Geneva) partners.</p>
<p>In this work, we developed DITAN, a novel unsupervised domain-agnostic framework for detecting and interpreting temporal-based anomalies. It is based on an encoder-decoder architecture with both implicit/explicit attention and adjustable layers/units for predicting normality as regular patterns in sequential data. A two-stage thresholding methodology with built-in pruning is used to detect anomalies, while root cause and similarities are interpreted in data and units space. Our approach is designed to intersect the 9 fundamental characteristics extracted from the union of related works. We demonstrate the DITAN modules on real-world datasets of 6 multivariate time series contaminated by point and contextual temporal-based anomalies at a varying duration. Experiments show a dominant predictability power of DITAN against the originally proposed models. DITAN is able to determine critical regions and thus identify anomalous events similarly well. Informative similarities between anomalous records are interpreted, since almost all similarities in units space are also verified in data space.</p>
<center>
<img src="../img/ditan_architecture.png" alt="“”" width="600">
</center>
We then developed an expert system as well as an inference engine to detect and classify anomalies.
<center>
<img src="../img/update_rule.png" alt="“”" width="600">
</center>
<p>We applied our method on multivariate timeeseries analysis of Vulcano, recorded in 2020.</p>
<center>
<img src="../img/vulcano_2020.png" alt="“”" width="600">
</center>
<section id="related-publications" class="level3">
<h3 data-anchor-id="related-publications">Related publications</h3>
<ol type="1">
<li><p>· M Giannoulis, A Harris, V Barra, DITAN: <a href="https://www.sciencedirect.com/science/article/abs/pii/S0031320323005125" target="_blank"> A deep-learning domain agnostic framework for Detection and Interpretation of Temporally-based multivariate ANomalies </a>, <strong>Pattern Recognition</strong>, 143, 2023</p></li>
<li><p>M Giannoulis, S Pailot-Bonnétat, V Barra, A Harris, External factors driving surface temperature changes above geothermal systems: answers from Deep Learning, <strong>Frontiers in Earth Science</strong>, 2024 (submitted)</p></li>
</ol>
</section>
</section>
<section id="characterization-of-volcanic-emissions-through-thermal-vision" class="level2">
<h2 data-anchor-id="characterization-of-volcanic-emissions-through-thermal-vision">Characterization of volcanic emissions through thermal vision</h2>
<hr>
<p>In April 2010, the eruption of Eyjafjallajökull (Iceland) threw volcanic ash several kilometres up into the atmosphere, an event which led to air travel disruption across northwest Europe for six days and which included the closure of airspace over many parts of Europe. This crisis spotlighted the necessity to parameterise and simulate plume dynamics through emission, dispersion and fall out as to better model, track and forecast cloud motions and locations. This eruption was classified as a Strombolian to Sub-Plinian eruption type. Numerous volcanoes from the five continents produce strombolian eruptions, which are a relatively mild form of explosive volcanic activity. Strombolian eruptions are small explosive events, 100s to 1000s of meter in height which occur more frequently than Vulcanian. They are also notable for the brilliant incandescent parabolic arcs traced by their molten ejecta. Emission of bombs, blocks, lapilli, and minor coarse ash is common during normal explosive activity. Lava flows and ash-rich eruptions plus paroxysms that send ash clouds to several kilometers are also frequent events as well.</p>
<p>On Stromboli, Strombolian activity has been observed and studied over several centuries. Over this period, the constant evolution of technology and the proliferation of monitoring equipment has improved our understanding of conduit dynamics and explosive behavior. Active volcanoes emit heat through lava flows, domes, lakes, degassing and erupting vents. Remote measurements of heat emission from such active features provide insights into the physical processes governing the associated volcanic activity. However, analyses and modelling as well as post processing of thermal data are still not fully automated, and quantitative parameters to feed to the modelers and responders in near-real time remain difficult to extract and provide.</p>
<p>Since 2001, thermal camera video has been increasingly used to track, parametrize and understand dynamic volcanic events, such that the use of such a capability is beginning to eclipse that of the satellite-based perspective. However, the complexity and size of these data sets are compounding the current problem of ever-accelerating data dates so as to require development new and different methodologies. For ongoing volcanic events, parameters, such as mass flux, ascent (or spreading) velocity and plume or lava expansion spreading rate, are key for understanding the dynamics of the explosive and effusive eruptions and the source mechanisms that drive them.</p>
<p>In this project, we concentrate on the different components of strombolian eruptions at the full range of remote sensing spatial scales. These range from millimeters (for individual particles in single thermal camera pixels) to kilometers (for the entire features imaged with the satellite field of view). We aim to characterise volcanic emissions through thermal vision.</p>
<center>
<img src="../img/volcano1.png" alt="“”" width="600">
</center>
<section id="related-publications-1" class="level3">
<h3 data-anchor-id="related-publications-1">Related publications</h3>
<ol type="1">
<li><p>M Bombrun, D Jessop, A Harris, V Barra. <a href="https://www.sciencedirect.com/science/article/pii/S037702731730450X%20" target="_blank">An algorithm for the detection and characterisation of volcanic plumes using thermal camera imagery</a> <strong>Journal of Volcanology and Geothermal Research</strong>,352: 26-37, 2018.</p></li>
<li><p>M Bombrun, L Spampinato, A Harris, V Barra, T Caltabiano. <a href="https://link.springer.com/article/10.1007/s10044-015-0524-9" target="_blank">On the transition from strombolian to fountaining activity: a thermal energy-based driver</a> <strong>Bulletin of Volcanology</strong>, 78,15, 2016.</p></li>
<li><p>M Bombrun, A Harris, L Gurioli, J Battaglia, V Barra. <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjP_cylxM__AhUZX_EDHRaRAVcQFnoECAkQAQ&amp;url=https%3A%2F%2Fagupubs.onlinelibrary.wiley.com%2Fdoi%2Fabs%2F10.1002%2F2014JB011556&amp;usg=AOvVaw2k0QIX-e5X6iqaRHw2cjyb&amp;opi=89978449" target="_blank">Anatomy of a strombolian eruption : Inferences from particle data recorded with thermal video</a> <strong>Journal of Geophysical Research</strong>,120,4 : 2367–2387, 2015.</p></li>
<li><p>M Bombrun, V Barra, A Harris. <a href="https://www.spiedigitallibrary.org/journals/Journal-of-Applied-Remote-Sensing/volume-8/issue-1/083549/Algorithm-for-particle-detection-and-parameterization-in-high-frame-rate/10.1117/1.JRS.8.083549.short?SSO=1" target="_blank">Algorithm for particle detection and parameterization in high-frame-rate thermal video</a> <strong>Journal of Applied Remote Sensing</strong>, 8(1), 083549, 2014.</p></li>
<li><p>A Harris, J Battaglia, F Donnadieu, L Gurioli, K Kelfoun, P Labazuy, G Sawyer, S Valade, M Bombrun, V Barra, D Delle Donne, G Lacanna. <a href="http://onlinelibrary.wiley.com/store/10.1002/2013EO370001/asset/eost2013EO370001.pdf?v=1&amp;t=jb6dl7av&amp;s=ceb35301e3423af45f00c2291dc18ea4f0c294e6" target="_blank">Modern Multispectral Sensors Help Track Explosive Eruptions</a>. <strong>EOS, Transactions American Geophysical Union</strong>, 94:321-328, 2013.</p></li>
<li><p>M Bombrun, D Jessop, V Barra, A Harris. Plume tracking algorithm : Parameterisation of volcanic plume dynamics. In <strong>Proc of the 26th general Assembly of IUGG</strong>, Prague, 2015.</p></li>
<li><p>M Bombrun, V Barra, A Harris. Analysis of Thermal Video for Coarse to Fine Particle Tracking in Volcanic Explosion Plume. <strong>SCIA’15</strong>, 2015.</p></li>
<li><p>M Bombrun, V Barra, A Harris. Particle detection and velocity prediction for volcanic eruptions : a preliminary study. <strong>IAVCEI</strong>, 2013.</p></li>
</ol>
<p>9/ S Valade, A Harris, G Sawyer, F Donnadieu, P Labazuy, K Kelfoun, M Bombrun, V Barra, C Hervier, M Ripepe, D Delle Donne, G Lacanna, M Burton, L Chevalier, T Stachowicz. Full bandwidth remote sensing for total parameterization of volcanic plumes. <strong>IAVCEI</strong>, 2013.</p>


</section>
</section>
</main></div>
    </div>
    <img src="../img/volcano.png" class="about-image
  round " style="height: 12em; width: 12em;">
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>